{"title":"提取和安全裂变","date":"2023-07-21T16:00:00.000Z","date_formatted":{"ll":"2023年7月22日","L":"2023/07/22","MM-DD":"07-22"},"link":"2023/07/22/2023-07-22","tags":["FE","UnoCSS","翻译"],"updated":"2024-01-24T01:26:39.000Z","content":"<h1 id=\"提取\">提取<a title=\"#提取\" href=\"#提取\"></a></h1>\n<p>UnoCSS通过在代码库中搜索工具的使用情况，并根据需求生成相应的CSS。我们将这个过程称为提取（extracting）。</p>\n<h2 id=\"内容来源\">内容来源<a title=\"#内容来源\" href=\"#内容来源\"></a></h2>\n<p>UnoCSS支持从多个来源提取工具的使用情况：</p>\n<ul>\n<li><a href=\"https://unocss.dev/guide/extracting#extracting-from-build-tools-pipeline\" target=\"_blank\">Pipeline</a> – 从您的构建工具流程中提取正确的部分</li>\n<li><a href=\"https://unocss.dev/guide/extracting#extracting-from-filesystem\" target=\"_blank\">Filesystem</a> – 通过读取和监视文件从您的文件系统中提取</li>\n<li><a href=\"https://unocss.dev/guide/extracting#extracting-from-inline-text\" target=\"_blank\">inline</a> – 从内联的纯文本中提取</li>\n</ul>\n<p>来自不同来源的工具使用情况将被合并在一起，并生成最终的CSS。</p>\n<h3 id=\"从构建工具流程中提取内容\">从构建工具流程中提取内容<a title=\"#从构建工具流程中提取内容\" href=\"#从构建工具流程中提取内容\"></a></h3>\n<p>这在 Vite 和 Webpack 的集成中得到支持。</p>\n<p>UnoCSS将读取通过构建工具流程的内容，并从中提取工具的使用情况。这是最高效和准确的提取方式，因为我们只智能提取实际在您的应用程序中使用的工具使用情况，并且在提取过程中不进行额外的文件IO操作。</p>\n<p>默认情况下，UnoCSS将从构建流程中的具有扩展名 .jsx、.tsx、.vue、.md、.html、.svelte、.astro 的文件中提取工具的使用情况，并根据需要生成相应的CSS。默认情况下，不包括 .js 和 .ts 文件。</p>\n<p>要进行配置，您可以更新您的 uno.config.ts 文件：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// uno.config.ts</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title function_\">defineConfig</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">content</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">pipeline</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">include</span>: [</span><br><span class=\"line\">        <span class=\"comment\">// the default</span></span><br><span class=\"line\">        <span class=\"regexp\">/\\.(vue|svelte|[jt]sx|mdx?|astro|elm|php|phtml|html)($|\\?)/</span>,</span><br><span class=\"line\">        <span class=\"comment\">// include js/ts files</span></span><br><span class=\"line\">        <span class=\"string\">&#x27;src/**/*.&#123;js,ts&#125;&#x27;</span>,</span><br><span class=\"line\">      ],</span><br><span class=\"line\">      <span class=\"comment\">// exclude files</span></span><br><span class=\"line\">      <span class=\"comment\">// exclude: []</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>您还可以在文件中的任何位置添加 @unocss-include 魔术注释，以文件为基础，告诉 UnoCSS 扫描该文件。或者，在配置中添加 *.js 或 *.ts，以将所有 js/ts 文件包括在扫描目标中。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ./some-utils.js</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// since `.js` files are not included by default,</span></span><br><span class=\"line\"><span class=\"comment\">// the following comment tells UnoCSS to force scan this file.</span></span><br><span class=\"line\"><span class=\"comment\">// @unocss-include</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> classes = &#123;</span><br><span class=\"line\">  <span class=\"attr\">active</span>: <span class=\"string\">&#x27;bg-primary text-white&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">inactive</span>: <span class=\"string\">&#x27;bg-gray-200 text-gray-500&#x27;</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>类似地，您还可以添加 @unocss-ignore 来跳过对文件的扫描和转换。</p>\n<p>如果您希望 UnoCSS 跳过某个代码块而不进行提取，您可以使用成对的 @unocss-skip-start 和 @unocss-skip-end 来实现：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;text-green text-xl&quot;</span>&gt;</span></span><br><span class=\"line\">  Green Large</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- @unocss-skip-start --&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- `text-red` will not be extracted --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;text-red&quot;</span>&gt;</span></span><br><span class=\"line\">  Red</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- @unocss-skip-end --&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"从文件系统中提取\">从文件系统中提取<a title=\"#从文件系统中提取\" href=\"#从文件系统中提取\"></a></h3>\n<p>在某些情况下，如果您使用的集成没有访问构建工具流程（例如，PostCSS 插件），或者您正在与后端框架进行集成且代码不经过构建流程，您可以手动指定要提取的文件。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// uno.config.ts</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title function_\">defineConfig</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">content</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">filesystem</span>: [</span><br><span class=\"line\">      <span class=\"string\">&#x27;src/**/*.php&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;public/*.html&#x27;</span>,</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>匹配的文件将直接从文件系统中读取，并在开发模式下进行更改监视。</p>\n<h3 id=\"从内联文本中提取\">从内联文本中提取<a title=\"#从内联文本中提取\" href=\"#从内联文本中提取\"></a></h3>\n<p>此外，您还可以从内联文本中提取工具的使用情况，这些文本可能来自其他地方。</p>\n<p>您还可以传递一个异步函数来返回内容。但请注意，该函数只会在构建时调用一次。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// uno.config.ts</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title function_\">defineConfig</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">content</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">inline</span>: [</span><br><span class=\"line\">      <span class=\"comment\">// plain text</span></span><br><span class=\"line\">      <span class=\"string\">&#x27;&lt;div class=&quot;p-4 text-red&quot;&gt;Some text&lt;/div&gt;&#x27;</span>,</span><br><span class=\"line\">      <span class=\"comment\">// async getter</span></span><br><span class=\"line\">      <span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> response = <span class=\"keyword\">await</span> <span class=\"title function_\">fetch</span>(<span class=\"string\">&#x27;https://example.com&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response.<span class=\"title function_\">text</span>()</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h2 id=\"局限性\">局限性<a title=\"#局限性\" href=\"#局限性\"></a></h2>\n<p>由于 UnoCSS 在构建时运行，这意味着只有静态呈现的工具才会生成并传递到您的应用程序中。在运行时动态使用或从外部资源获取的工具可能不会被应用。</p>\n<h3 id=\"安全列表\">安全列表<a title=\"#安全列表\" href=\"#安全列表\"></a></h3>\n<p>有时您可能希望使用动态的拼接，例如：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;p-$&#123;size&#125;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> <span class=\"comment\">&lt;!-- this won&#x27;t work! --&gt;</span></span><br></pre></td></tr></table></figure>\n<p>由于 UnoCSS 在构建时使用静态提取，我们无法在编译时知道所有工具的组合情况。因此，您可以配置 safelist 选项来解决这个问题。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// uno.config.ts</span></span><br><span class=\"line\"><span class=\"attr\">safelist</span>: <span class=\"string\">&#x27;p-1 p-2 p-3 p-4&#x27;</span>.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27; &#x27;</span>)</span><br></pre></td></tr></table></figure>\n<p>生成对应的 CSS：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.p-1</span> &#123; <span class=\"attribute\">padding</span>: <span class=\"number\">0.25rem</span>; &#125;</span><br><span class=\"line\"><span class=\"selector-class\">.p-2</span> &#123; <span class=\"attribute\">padding</span>: <span class=\"number\">0.5rem</span>; &#125;</span><br><span class=\"line\"><span class=\"selector-class\">.p-3</span> &#123; <span class=\"attribute\">padding</span>: <span class=\"number\">0.75rem</span>; &#125;</span><br><span class=\"line\"><span class=\"selector-class\">.p-4</span> &#123; <span class=\"attribute\">padding</span>: <span class=\"number\">1rem</span>; &#125;</span><br></pre></td></tr></table></figure>\n<p>或者更灵活：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// uno.config.ts</span></span><br><span class=\"line\"><span class=\"attr\">safelist</span>: [</span><br><span class=\"line\">  ...<span class=\"title class_\">Array</span>.<span class=\"title function_\">from</span>(&#123; <span class=\"attr\">length</span>: <span class=\"number\">4</span> &#125;, <span class=\"function\">(<span class=\"params\">_, i</span>) =&gt;</span> <span class=\"string\">`p-<span class=\"subst\">$&#123;i + <span class=\"number\">1</span>&#125;</span>`</span>),</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>如果您希望在运行时进行真正的动态生成，您可以查看 @unocss/runtime 包</p>\n<h3 id=\"黑名单\">黑名单<a title=\"#黑名单\" href=\"#黑名单\"></a></h3>\n<p>类似于 safelist，您还可以配置 blocklist 来排除某些工具的生成。不同于 safelist，blocklist 接受字符串进行精确匹配和正则表达式进行模式匹配。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// uno.config.ts</span></span><br><span class=\"line\"><span class=\"attr\">blocklist</span>: [</span><br><span class=\"line\">  <span class=\"string\">&#x27;p-1&#x27;</span>,</span><br><span class=\"line\">  <span class=\"regexp\">/^p-[2-4]$/</span>,</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>这将排除 p-1、p-2、p-3 和 p-4 的生成。这对于排除一些误报非常有用。</p>\n","prev":{"title":"CRUD配置工具 设计","link":"2023/09/01/2023-09-08"},"next":{"title":"配置文件","link":"2023/07/16/2023-07-16"},"plink":"https://pi-char.github.io/2023/07/22/2023-07-22/","toc":[{"id":"提取","title":"提取","index":"1","children":[{"id":"内容来源","title":"内容来源","index":"1.1","children":[{"id":"从构建工具流程中提取内容","title":"从构建工具流程中提取内容","index":"1.1.1"},{"id":"从文件系统中提取","title":"从文件系统中提取","index":"1.1.2"},{"id":"从内联文本中提取","title":"从内联文本中提取","index":"1.1.3"}]},{"id":"局限性","title":"局限性","index":"1.2","children":[{"id":"安全列表","title":"安全列表","index":"1.2.1"},{"id":"黑名单","title":"黑名单","index":"1.2.2"}]}]}],"reading_time":"1160 字约 8 分钟"}